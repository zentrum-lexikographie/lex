---
firewall_allowed_tcp_ports:
  - "22"
  - "80"
  - "443"

apache_mods_enabled:
  - rewrite.load
  - ssl.load
  - headers.load
  - proxy.load
  - proxy_http.load
  - proxy_http2.load
  - authz_groupfile.load

apache_remove_default_vhost: true
apache_vhosts:
  - servername: "{{ ansible_fqdn }}"
    documentroot: "/var/www"
    allow_override: "None"
    extra_parameters: |
      {{ zdl_apache_vhost_config }}

zdl_api_context_paths:
  - /article
  - /assets
  - /git
  - /home
  - /lock
  - /index
  - /mantis
  - /status

zdl_apache_vhost_config: |
  ErrorLog ${APACHE_LOG_DIR}/error.log
  CustomLog ${APACHE_LOG_DIR}/access.log combined

  <Location />
    AuthType Basic
    AuthName ZDL-Lex-Server
    AuthUserFile htpasswd
    AuthGroupFile htgroup

    Require valid-user

    RequestHeader set X-Remote-User %{REMOTE_USER}s
  </Location>

  <DirectoryMatch ^\.|\/\.>
    Order allow,deny
    Deny from all
  </DirectoryMatch>

  Alias /zdl-lex-client {{ lex_client_dir }}
  <Location /zdl-lex-client>
    Options +Indexes
    Require all granted
  </Location>

  RedirectMatch ^/$ /home

  ProxyTimeout 300

  {% for cp in zdl_api_context_paths %}
  <Location {{ cp }}>
    ProxyPass http://localhost:3000{{ cp }} retry=0
    ProxyPassReverse http://localhost:3000{{ cp }}
  </Location>
  {% endfor %}

  <Location /solr>
    ProxyPass http://localhost:8983/solr retry=0
    ProxyPassReverse http://localhost:8983/solr
    Require group admin
  </Location>

solr_version: "7.7.1"
solr_timezone: "Europe/Berlin"
solr_cores:
  - "articles"

lex_client_dir: "/home/lex/zdl-lex-client"
lex_data_dir: "/var/lex"

zdl_lex_version: "{{ lookup('file', '../VERSION') }}"
